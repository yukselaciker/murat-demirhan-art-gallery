{
  "version": 3,
  "sources": ["../../../worker/index.ts"],
  "sourceRoot": "C:\\Users\\Hakan A\u00E7\u0131ker\\Desktop\\murat demirhan art gallery\\.wrangler\\tmp\\deploy-lcz5HP",
  "sourcesContent": ["/**\r\n * Murat Demirhan Art Gallery - Cloudflare Worker\r\n * D1 Database + R2 Storage Integration\r\n * Features: Artworks CRUD, Feed Posts with Emoji Reactions\r\n */\r\n\r\ninterface Env {\r\n    DB: D1Database;\r\n    R2_BUCKET: R2Bucket;\r\n    ADMIN_TOKEN?: string;\r\n    VIEWER_SALT?: string;\r\n    ENV: string;\r\n}\r\n\r\n// ============ TYPES ============\r\n\r\ninterface Artwork {\r\n    id: number;\r\n    title: string;\r\n    year: number | null;\r\n    technique: string | null;\r\n    size: string | null;\r\n    image_url: string | null;\r\n    category: string | null;\r\n    created_at: string;\r\n    updated_at: string;\r\n}\r\n\r\ninterface Post {\r\n    id: string;\r\n    title: string | null;\r\n    body: string | null;\r\n    images_json: string | null;\r\n    created_at: string;\r\n    status: 'published' | 'draft';\r\n}\r\n\r\ninterface PostWithReactions extends Post {\r\n    reactions: EmojiCounts;\r\n}\r\n\r\ninterface EmojiCounts {\r\n    heart: number;\r\n    fire: number;\r\n    clap: number;\r\n    wow: number;\r\n}\r\n\r\ntype EmojiType = 'heart' | 'fire' | 'clap' | 'wow';\r\nconst VALID_EMOJIS: EmojiType[] = ['heart', 'fire', 'clap', 'wow'];\r\n\r\n// ============ CORS CONFIG ============\r\n\r\nconst ALLOWED_ORIGINS = [\r\n    'https://murat-demirhan.vercel.app',\r\n    'https://muratdemirhan.com',\r\n    'http://localhost:5173',\r\n    'http://localhost:3000',\r\n];\r\n\r\nfunction getCorsHeaders(origin: string | null): Record<string, string> {\r\n    const allowedOrigin = origin && ALLOWED_ORIGINS.includes(origin) ? origin : ALLOWED_ORIGINS[0];\r\n    return {\r\n        'Access-Control-Allow-Origin': allowedOrigin,\r\n        'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\r\n        'Access-Control-Allow-Headers': 'Content-Type, Authorization',\r\n        'Access-Control-Max-Age': '86400',\r\n    };\r\n}\r\n\r\n// ============ RESPONSE HELPERS ============\r\n\r\nfunction jsonResponse(data: unknown, status = 200, origin: string | null = null): Response {\r\n    return new Response(JSON.stringify(data), {\r\n        status,\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            ...getCorsHeaders(origin),\r\n        },\r\n    });\r\n}\r\n\r\nfunction errorResponse(message: string, status = 500, origin: string | null = null): Response {\r\n    return jsonResponse({ error: message }, status, origin);\r\n}\r\n\r\n// ============ AUTH HELPERS ============\r\n\r\nfunction isAdminAuthorized(request: Request, env: Env): boolean {\r\n    const authHeader = request.headers.get('Authorization');\r\n    if (!authHeader || !env.ADMIN_TOKEN) return false;\r\n    return authHeader === `Bearer ${env.ADMIN_TOKEN}`;\r\n}\r\n\r\nasync function generateViewerHash(request: Request, env: Env): Promise<string> {\r\n    const ip = request.headers.get('CF-Connecting-IP') || 'unknown';\r\n    const userAgent = request.headers.get('User-Agent') || 'unknown';\r\n    const salt = env.VIEWER_SALT || 'default-salt';\r\n\r\n    const data = new TextEncoder().encode(`${ip}|${userAgent}|${salt}`);\r\n    const hashBuffer = await crypto.subtle.digest('SHA-256', data);\r\n    const hashArray = Array.from(new Uint8Array(hashBuffer));\r\n    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\r\n}\r\n\r\nfunction generateUUID(): string {\r\n    return crypto.randomUUID();\r\n}\r\n\r\n// ============ MAIN HANDLER ============\r\n\r\nexport default {\r\n    async fetch(request: Request, env: Env): Promise<Response> {\r\n        const url = new URL(request.url);\r\n        const path = url.pathname;\r\n        const method = request.method;\r\n        const origin = request.headers.get('Origin');\r\n\r\n        // Handle CORS preflight\r\n        if (method === 'OPTIONS') {\r\n            return new Response(null, { status: 204, headers: getCorsHeaders(origin) });\r\n        }\r\n\r\n        try {\r\n            // ============ ARTWORKS API ============\r\n            if (path.startsWith('/api/artworks')) {\r\n                return await handleArtworks(request, env, url, origin);\r\n            }\r\n\r\n            // ============ FEED/POSTS API ============\r\n            if (path === '/api/posts' && method === 'GET') {\r\n                return await handleGetPosts(env, origin);\r\n            }\r\n\r\n            if (path === '/api/admin/posts' && method === 'POST') {\r\n                return await handleCreatePost(request, env, origin);\r\n            }\r\n\r\n            // POST /api/posts/:id/react\r\n            const reactMatch = path.match(/^\\/api\\/posts\\/([^/]+)\\/react$/);\r\n            if (reactMatch && method === 'POST') {\r\n                return await handleReaction(request, env, reactMatch[1], origin);\r\n            }\r\n\r\n            // POST /api/admin/upload-url\r\n            if (path === '/api/admin/upload-url' && method === 'POST') {\r\n                return await handleUploadUrl(request, env, origin);\r\n            }\r\n\r\n            // ============ R2 IMAGE SERVE ============\r\n            if (path.startsWith('/images/')) {\r\n                return await handleImages(request, env, path, origin);\r\n            }\r\n\r\n            // ============ HEALTH CHECK ============\r\n            if (path === '/health' || path === '/') {\r\n                return jsonResponse({\r\n                    status: 'ok',\r\n                    worker: 'murat-demirhan-worker',\r\n                    timestamp: new Date().toISOString(),\r\n                }, 200, origin);\r\n            }\r\n\r\n            return errorResponse('Not Found', 404, origin);\r\n        } catch (error) {\r\n            console.error('Worker error:', error);\r\n            return errorResponse('Internal Server Error', 500, origin);\r\n        }\r\n    },\r\n};\r\n\r\n// ============ ARTWORKS HANDLER ============\r\n\r\nasync function handleArtworks(\r\n    request: Request,\r\n    env: Env,\r\n    url: URL,\r\n    origin: string | null\r\n): Promise<Response> {\r\n    const method = request.method;\r\n\r\n    // GET - List all artworks\r\n    if (method === 'GET') {\r\n        const full = url.searchParams.get('full') === 'true';\r\n        const id = url.searchParams.get('id');\r\n\r\n        if (id) {\r\n            const result = await env.DB.prepare('SELECT * FROM artworks WHERE id = ?')\r\n                .bind(id)\r\n                .first<Artwork>();\r\n\r\n            if (!result) {\r\n                return errorResponse('Artwork not found', 404, origin);\r\n            }\r\n            return jsonResponse(result, 200, origin);\r\n        }\r\n\r\n        const columns = full ? '*' : 'id, title, image_url, year, technique, size, category, created_at';\r\n        const limit = full ? 1000 : 50;\r\n\r\n        const { results } = await env.DB.prepare(\r\n            `SELECT ${columns} FROM artworks ORDER BY created_at DESC LIMIT ?`\r\n        ).bind(limit).all<Artwork>();\r\n\r\n        return jsonResponse(results || [], 200, origin);\r\n    }\r\n\r\n    // POST - Create new artwork (ADMIN ONLY)\r\n    if (method === 'POST') {\r\n        if (!isAdminAuthorized(request, env)) {\r\n            return errorResponse('Unauthorized', 401, origin);\r\n        }\r\n\r\n        const body = await request.json<Partial<Artwork>>();\r\n\r\n        if (!body.title || !body.title.trim()) {\r\n            return errorResponse('Title is required', 400, origin);\r\n        }\r\n\r\n        const result = await env.DB.prepare(\r\n            `INSERT INTO artworks (title, year, technique, size, image_url, category)\r\n       VALUES (?, ?, ?, ?, ?, ?)\r\n       RETURNING *`\r\n        ).bind(\r\n            body.title.trim(),\r\n            body.year || null,\r\n            body.technique || null,\r\n            body.size || null,\r\n            body.image_url || null,\r\n            body.category || null\r\n        ).first<Artwork>();\r\n\r\n        return jsonResponse(result, 201, origin);\r\n    }\r\n\r\n    // PUT - Update artwork (ADMIN ONLY)\r\n    if (method === 'PUT') {\r\n        if (!isAdminAuthorized(request, env)) {\r\n            return errorResponse('Unauthorized', 401, origin);\r\n        }\r\n\r\n        const id = url.searchParams.get('id');\r\n        if (!id) {\r\n            return errorResponse('id parameter required', 400, origin);\r\n        }\r\n\r\n        const body = await request.json<Partial<Artwork>>();\r\n\r\n        const result = await env.DB.prepare(\r\n            `UPDATE artworks \r\n       SET title = ?, year = ?, technique = ?, size = ?, image_url = ?, category = ?, updated_at = CURRENT_TIMESTAMP\r\n       WHERE id = ?\r\n       RETURNING *`\r\n        ).bind(\r\n            body.title || '',\r\n            body.year || null,\r\n            body.technique || null,\r\n            body.size || null,\r\n            body.image_url || null,\r\n            body.category || null,\r\n            id\r\n        ).first<Artwork>();\r\n\r\n        if (!result) {\r\n            return errorResponse('Artwork not found', 404, origin);\r\n        }\r\n\r\n        return jsonResponse(result, 200, origin);\r\n    }\r\n\r\n    // DELETE - Remove artwork (ADMIN ONLY)\r\n    if (method === 'DELETE') {\r\n        if (!isAdminAuthorized(request, env)) {\r\n            return errorResponse('Unauthorized', 401, origin);\r\n        }\r\n\r\n        const id = url.searchParams.get('id');\r\n        if (!id) {\r\n            return errorResponse('id parameter required', 400, origin);\r\n        }\r\n\r\n        await env.DB.prepare('DELETE FROM artworks WHERE id = ?').bind(id).run();\r\n        return jsonResponse({ ok: true, deleted: id }, 200, origin);\r\n    }\r\n\r\n    return errorResponse('Method not allowed', 405, origin);\r\n}\r\n\r\n// ============ FEED POSTS HANDLERS ============\r\n\r\nasync function handleGetPosts(env: Env, origin: string | null): Promise<Response> {\r\n    // Get published posts\r\n    const { results: posts } = await env.DB.prepare(\r\n        `SELECT id, title, body, images_json, created_at, status\r\n     FROM posts\r\n     WHERE status = 'published'\r\n     ORDER BY created_at DESC\r\n     LIMIT 100`\r\n    ).all<Post>();\r\n\r\n    if (!posts || posts.length === 0) {\r\n        return jsonResponse({ items: [] }, 200, origin);\r\n    }\r\n\r\n    // Get reactions for all posts\r\n    const postIds = posts.map(p => p.id);\r\n    const placeholders = postIds.map(() => '?').join(',');\r\n\r\n    const { results: reactions } = await env.DB.prepare(\r\n        `SELECT post_id, emoji, count FROM reactions WHERE post_id IN (${placeholders})`\r\n    ).bind(...postIds).all<{ post_id: string; emoji: EmojiType; count: number }>();\r\n\r\n    // Build reactions map\r\n    const reactionsMap: Record<string, EmojiCounts> = {};\r\n    for (const post of posts) {\r\n        reactionsMap[post.id] = { heart: 0, fire: 0, clap: 0, wow: 0 };\r\n    }\r\n    for (const r of reactions || []) {\r\n        if (reactionsMap[r.post_id]) {\r\n            reactionsMap[r.post_id][r.emoji] = r.count;\r\n        }\r\n    }\r\n\r\n    // Format response\r\n    const items = posts.map(post => ({\r\n        id: post.id,\r\n        title: post.title,\r\n        body: post.body,\r\n        images: post.images_json ? JSON.parse(post.images_json) : [],\r\n        createdAt: post.created_at,\r\n        reactions: reactionsMap[post.id],\r\n    }));\r\n\r\n    return jsonResponse({ items }, 200, origin);\r\n}\r\n\r\nasync function handleCreatePost(\r\n    request: Request,\r\n    env: Env,\r\n    origin: string | null\r\n): Promise<Response> {\r\n    // Admin auth check\r\n    if (!isAdminAuthorized(request, env)) {\r\n        return errorResponse('Unauthorized', 401, origin);\r\n    }\r\n\r\n    const body = await request.json<{\r\n        title?: string;\r\n        body?: string;\r\n        images?: string[];\r\n        status?: 'published' | 'draft';\r\n    }>();\r\n\r\n    const postId = generateUUID();\r\n    const now = new Date().toISOString();\r\n    const imagesJson = body.images ? JSON.stringify(body.images) : null;\r\n    const status = body.status || 'draft';\r\n\r\n    // Insert post\r\n    await env.DB.prepare(\r\n        `INSERT INTO posts (id, title, body, images_json, created_at, status)\r\n     VALUES (?, ?, ?, ?, ?, ?)`\r\n    ).bind(postId, body.title || null, body.body || null, imagesJson, now, status).run();\r\n\r\n    // Initialize emoji reactions with 0 count\r\n    const batch = env.DB.batch([\r\n        env.DB.prepare('INSERT INTO reactions (post_id, emoji, count) VALUES (?, ?, 0)').bind(postId, 'heart'),\r\n        env.DB.prepare('INSERT INTO reactions (post_id, emoji, count) VALUES (?, ?, 0)').bind(postId, 'fire'),\r\n        env.DB.prepare('INSERT INTO reactions (post_id, emoji, count) VALUES (?, ?, 0)').bind(postId, 'clap'),\r\n        env.DB.prepare('INSERT INTO reactions (post_id, emoji, count) VALUES (?, ?, 0)').bind(postId, 'wow'),\r\n    ]);\r\n    await batch;\r\n\r\n    return jsonResponse({\r\n        id: postId,\r\n        title: body.title || null,\r\n        body: body.body || null,\r\n        images: body.images || [],\r\n        createdAt: now,\r\n        status,\r\n        reactions: { heart: 0, fire: 0, clap: 0, wow: 0 },\r\n    }, 201, origin);\r\n}\r\n\r\nasync function handleReaction(\r\n    request: Request,\r\n    env: Env,\r\n    postId: string,\r\n    origin: string | null\r\n): Promise<Response> {\r\n    const body = await request.json<{ emoji: string }>();\r\n\r\n    // Validate emoji\r\n    if (!VALID_EMOJIS.includes(body.emoji as EmojiType)) {\r\n        return errorResponse('Invalid emoji. Must be: heart, fire, clap, wow', 400, origin);\r\n    }\r\n\r\n    const emoji = body.emoji as EmojiType;\r\n    const viewerHash = await generateViewerHash(request, env);\r\n    const now = new Date().toISOString();\r\n\r\n    // Check if post exists\r\n    const post = await env.DB.prepare('SELECT id FROM posts WHERE id = ?').bind(postId).first();\r\n    if (!post) {\r\n        return errorResponse('Post not found', 404, origin);\r\n    }\r\n\r\n    // Try to insert reaction event (anti-spam)\r\n    try {\r\n        await env.DB.prepare(\r\n            `INSERT INTO reaction_events (post_id, emoji, viewer_hash, created_at)\r\n       VALUES (?, ?, ?, ?)`\r\n        ).bind(postId, emoji, viewerHash, now).run();\r\n    } catch (error: unknown) {\r\n        // UNIQUE constraint violation = already reacted\r\n        if (error instanceof Error && error.message.includes('UNIQUE')) {\r\n            return errorResponse('already_reacted', 409, origin);\r\n        }\r\n        throw error;\r\n    }\r\n\r\n    // Increment reaction count\r\n    await env.DB.prepare(\r\n        `UPDATE reactions SET count = count + 1 WHERE post_id = ? AND emoji = ?`\r\n    ).bind(postId, emoji).run();\r\n\r\n    // Get updated count\r\n    const reaction = await env.DB.prepare(\r\n        `SELECT count FROM reactions WHERE post_id = ? AND emoji = ?`\r\n    ).bind(postId, emoji).first<{ count: number }>();\r\n\r\n    return jsonResponse({\r\n        success: true,\r\n        emoji,\r\n        count: reaction?.count || 1,\r\n    }, 200, origin);\r\n}\r\n\r\n// ============ UPLOAD URL HANDLER ============\r\n\r\nasync function handleUploadUrl(\r\n    request: Request,\r\n    env: Env,\r\n    origin: string | null\r\n): Promise<Response> {\r\n    // Admin auth check\r\n    if (!isAdminAuthorized(request, env)) {\r\n        return errorResponse('Unauthorized', 401, origin);\r\n    }\r\n\r\n    const body = await request.json<{ filename: string; contentType: string }>();\r\n\r\n    // Validate content type\r\n    const validImageTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];\r\n    if (!validImageTypes.includes(body.contentType)) {\r\n        return errorResponse('Invalid content type. Must be an image.', 400, origin);\r\n    }\r\n\r\n    // Generate R2 key under feed/ path\r\n    const now = new Date();\r\n    const year = now.getFullYear();\r\n    const month = String(now.getMonth() + 1).padStart(2, '0');\r\n    const uuid = generateUUID();\r\n    const ext = body.filename.split('.').pop() || 'jpg';\r\n    const key = `feed/${year}/${month}/${uuid}.${ext}`;\r\n\r\n    // Note: For presigned URLs, you'd typically use R2's presigned URL feature\r\n    // Since Workers can't generate presigned URLs directly, we return the key\r\n    // and the frontend uploads via a separate endpoint\r\n\r\n    return jsonResponse({\r\n        key,\r\n        // In production, you'd integrate with R2 presigned URLs or a direct upload endpoint\r\n        uploadUrl: `/api/admin/upload?key=${encodeURIComponent(key)}`,\r\n    }, 200, origin);\r\n}\r\n\r\n// ============ IMAGES HANDLER (R2) ============\r\n\r\nasync function handleImages(\r\n    request: Request,\r\n    env: Env,\r\n    path: string,\r\n    origin: string | null\r\n): Promise<Response> {\r\n    const imageKey = path.replace('/images/', '');\r\n\r\n    if (request.method === 'GET') {\r\n        const object = await env.R2_BUCKET.get(imageKey);\r\n\r\n        if (!object) {\r\n            return errorResponse('Image not found', 404, origin);\r\n        }\r\n\r\n        const headers = new Headers();\r\n        object.writeHttpMetadata(headers);\r\n        headers.set('etag', object.httpEtag);\r\n        headers.set('Cache-Control', 'public, max-age=31536000');\r\n\r\n        return new Response(object.body, { headers });\r\n    }\r\n\r\n    // POST - Upload image (admin only)\r\n    if (request.method === 'POST') {\r\n        if (!isAdminAuthorized(request, env)) {\r\n            return errorResponse('Unauthorized', 401, origin);\r\n        }\r\n\r\n        const formData = await request.formData();\r\n        const fileData = formData.get('file');\r\n\r\n        if (!fileData || typeof fileData === 'string') {\r\n            return errorResponse('No file provided', 400, origin);\r\n        }\r\n\r\n        // Cast to File after type guard\r\n        const file = fileData as unknown as File;\r\n\r\n        // Validate it's an image\r\n        if (!file.type.startsWith('image/')) {\r\n            return errorResponse('File must be an image', 400, origin);\r\n        }\r\n\r\n        await env.R2_BUCKET.put(imageKey, file.stream(), {\r\n            httpMetadata: {\r\n                contentType: file.type,\r\n            },\r\n        });\r\n\r\n        return jsonResponse({ key: imageKey, url: `/images/${imageKey}` }, 201, origin);\r\n    }\r\n\r\n    return errorResponse('Method not allowed', 405, origin);\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
